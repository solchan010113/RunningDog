<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="walkLog">
   
   <!-- 쿼리문 작성 --> 
	
	<!-- 유저 1명 가져오기 (로그인) -->
	<select id="selectOneUser" parameterType="com.runningdog.vo.UserVo" resultType="com.runningdog.vo.UserVo">
		<![CDATA[
			select  userNo
					,code
			from users
			where id = #{id}
			and password = #{password}
		]]>
	</select>  
	 
   <!-- 맵 산책로 불러오기 (동네전부) -->
   <select id="mapTrailSelect" parameterType="int" resultType="com.runningdog.vo.UseTrailVo">
      <![CDATA[
         SELECT  tr.trailno as trailNo
        		 ,tr.name as name
		         ,co.coordorder as coordOrder
		         ,co.lat as lat
		         ,co.lng as lng
		 FROM trail tr, coords co
	 	 where co.type = 'trail'
	 	 and locationno = #{locationNo}
		 and tr.trailno = co.useno
		 ORDER BY co.coordorder asc
      ]]>
   </select>   
   
   <!-- 기록 산책로 불러오기 (3개) -->
   <select id="endTrailSelect"  resultType="com.runningdog.vo.UseTrailVo">
      <![CDATA[
         SELECT co.coordno as coordNo
		        ,tr.trailno as trailNo
		        ,tr.name as name
		        ,co.coordorder as coordOrder
		        ,co.lat as lat
		        ,co.lng as lng
         FROM trail tr, coords co
         where co.type = 'trail'
         and tr.trailno = co.useno
         ORDER BY co.coordno asc
         , co.coordorder asc
      ]]>
   </select>   
  
   <!-- 내 강아지 가져오기 -->   
   <select id="dogSelect"  parameterType="int" resultType="com.runningdog.vo.MoDogVo">
      <![CDATA[
         SELECT  us.userno as userNo
		         ,us.name  as userName
		         ,do.dogno as dogNo
		         ,do.name as dogName
		         ,im.orgname as orgName
		         ,im.savename as saveName
		 FROM users us,dog do, images im
	 	 where us.userno = #{userNo}
	 	 and im.type = 'dog'
	 	 and us.userno = do.userno
		 and do.dogno = im.useno
      ]]>
   </select>    
   
   <!-- 내 동네번호 가져오기 -->   
   <select id="locationSelect"  parameterType="com.runningdog.vo.LocationVo" resultType="int">
      <![CDATA[
         select locationNo
	 	 from location
	 	 where GU = #{gu}
		 and DONG = #{dong}
      ]]>
   </select>      
   
   <!-- 산책기록 저장하기 -->
   <insert id="walkLogInsert"  parameterType="com.runningdog.vo.MoWalkLogVo" >
		<selectKey resultType="int" keyProperty="walkLogNo" order="BEFORE">
			<![CDATA[
				SELECT seq_walkdog_no.nextVal FROM dual    
			]]>
		</selectKey>
      <![CDATA[
	         INSERT INTO walkLog
			 VALUES (#{walkLogNo},  
			         #{userNo},
			         #{locationNo}, 
			         #{meetingNo}, 
			         #{title, jdbcType=VARCHAR},
			         SYSDATE,
			         to_date(#{startTime},'YY-MM-DD HH:MI'),
			         to_date(#{endTime},'YY-MM-DD HH:MI'),
			         #{logTime},
			         #{distance},
			         #{content, jdbcType=VARCHAR},
			         #{security},
			         #{status}
			         )
      ]]>
   </insert>   
   
   
   <!-- 산책강아지 저장하기 -->
   <insert id="walkedDogInsert"  parameterType="com.runningdog.vo.MoWalkedDogVo" >
      <![CDATA[
         INSERT INTO walkedDog
		 VALUES (seq_walkeddog_no.nextVal,
		         #{walkLogNo},
		         #{dogNo}   
		         )
      ]]>
   </insert>
   
    <!-- 좌표 저장하기 -->
   <insert id="coordsInsert"  parameterType="com.runningdog.vo.CoordsVo" >
      <![CDATA[
         INSERT INTO coords (coordNo, coordOrder, type, useNo, lng, lat) 
		 VALUES (seq_coords_no.NEXTVAL,
		         #{coordOrder},
		         'walkLog',
		         #{useNo},
		         #{lng},
		         #{lat}
		         )
      ]]>
   </insert>
   
   <insert id="imgsSave" parameterType="com.runningdog.vo.ImagesVo">  
		 <![CDATA[
		 INSERT INTO images
		 VALUES (seq_images_no.nextval
                      ,#{orgName}
                      ,#{saveName}
                      ,#{filePath}
                      ,#{fileSize}
                      ,#{type}
                      ,#{useNo}
                      ,#{imageOrder}
                      )
		 ]]>
	</insert>
	
	<insert id="mapImgSave" parameterType="com.runningdog.vo.ImagesVo">  
		 <![CDATA[
		 INSERT INTO images
		 VALUES (seq_images_no.nextval
                      ,#{orgName}
                      ,#{saveName}
                      ,#{filePath}
                      ,#{fileSize}
                      ,#{type}
                      ,#{useNo}
                      ,#{imageOrder}
                      )
		 ]]>
	</insert>
	
   
   <!-- 좌표값 가져오기 (캡쳐용) -->   
   <select id="mapSelect"  parameterType="int" resultType="com.runningdog.vo.CoordsVo">
      <![CDATA[
        SELECT  coordorder
		        ,lat
		        ,lng
		FROM coords
		where type = 'walkLog' 
		and useno = #{walkLogNo} 
		ORDER BY coordorder asc
      ]]>
   </select>
     
   <!-- 산책로 가져오기 -->   
   <select id="trailSelect"  parameterType="int" resultType="com.runningdog.vo.MoTrailVo">
      <![CDATA[
        SELECT tr.trailNo
		       ,tr.name   
		FROM (
		    SELECT  trailNo
		            ,name            
		    FROM trail
		    WHERE locationNo = #{locationNo} 
		    ORDER BY name) tr
		WHERE ROWNUM <= 3
      ]]>
   </select>
   
   

</mapper>