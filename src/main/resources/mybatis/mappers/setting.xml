<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="setting">

	<!-- 유저 1명 가져오기 (이미지 제외) -->
	<select id="selectUser" parameterType="int" resultType="com.runningdog.vo.UserVo">
		<![CDATA[
			select  u.name name,
			        u.code code,
			        to_char(u.birth, 'YYYY-MM-DD') birth,
			        u.gender gender,
			        u.locationNo locationNo,
			        l.si si,
			        l.gu gu,
			        l.dong dong,
			        u.status status
			from users u, location l
			where u.userNo = #{userNo}
			and u.locationNo = l.locationNo
		]]>
	</select>
	
	<!-- 유저 1명 가져오기 (이미지만) -->
	<select id="selectUserImg" parameterType="int" resultType="String">
		<![CDATA[
			select saveName
			from images
			where type = 'users'
			and useNo = #{userNo}
		]]>
	</select>


	<!-- id로 no 찾기 -->
	<select id="selectUserNoWithId" parameterType="String" resultType="int">
		<![CDATA[
			select userNo
			from users
			where id = #{id}
		]]>
	</select>


	<!-- 프로필 새로 등록 시 기존 사진 row 지우기 -->
	<delete id="deleteUserProfile" parameterType="int">
		<![CDATA[
			delete from images
			where useNo = #{useNo}
		]]>
	</delete>

	<!-- user profile 업로드한 파일 정보 저장 -->
	<insert id="insertUserProfile" parameterType="com.runningdog.vo.MainImageVo">
		<![CDATA[
			insert into images
			values(seq_images_no.nextval, #{orgName}, #{saveName}, #{filePath}, #{fileSize}, 'users', #{useNo}, 0)
		]]>
	</insert>

	<!-- 회원 정보 수정 -->
	<update id="updateUser" parameterType="com.runningdog.vo.UserVo">
		<![CDATA[
			update users
			set  locationNo = #{locationNo},
			     name = #{name},
			     birth = #{birth, jdbcType = VARCHAR},
			     gender = #{gender, jdbcType = VARCHAR}
			where userNo = #{userNo}
		]]>
	</update>
	
	
	<!-- 동네 검색 -->
	<select id="selectAddressList" parameterType="String" resultType="com.runningdog.vo.UserVo">
		<![CDATA[
			SELECT  locationNo,
			        si,
			        gu,
			        dong
			FROM location
			WHERE gu || dong LIKE REPLACE('%'||#{keyword}||'%', ' ', '')
			order by locationNo asc
		]]>
	</select>
	

</mapper>






